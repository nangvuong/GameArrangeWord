<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.Line?>

<StackPane xmlns:fx="http://javafx.com/fxml"
           fx:controller="com.ltm.game_client_v3.views.GameSortingController"
           stylesheets="@gamesortingview.css"
           prefWidth="1280" prefHeight="720"
           styleClass="game-container">

    <!-- Background Image -->
    <ImageView fx:id="backgroundImage" fitWidth="1280" fitHeight="720" preserveRatio="false">
        <image>
            <Image url="@../images/game-bg.jpg"/>
        </image>
    </ImageView>
    <Pane style="-fx-background-color: rgba(0,0,0,0.6);"/>

    <!-- Main Content -->
    <BorderPane>
        <padding>
            <Insets top="20" right="40" bottom="20" left="40"/>
        </padding>

        <!-- TOP: Player Info & Game Stats -->
        <top>
            <GridPane hgap="30" alignment="CENTER">
                <columnConstraints>
                    <ColumnConstraints percentWidth="40"/>
                    <ColumnConstraints percentWidth="20"/>
                    <ColumnConstraints percentWidth="40"/>
                </columnConstraints>

                <!-- Player 1 Panel (YOU) -->
                <VBox styleClass="player-panel" alignment="CENTER_LEFT" GridPane.columnIndex="0">
                    <HBox alignment="CENTER_LEFT" spacing="15">
                        <ImageView fx:id="userAvatar" fitHeight="50" fitWidth="50" styleClass="avatar-image"/>
                        <VBox>
                            <Label fx:id="userNickname" text="Player 1" styleClass="player-nickname"/>
                            <Label fx:id="userWins" text="Wins: 0" styleClass="player-sub-stats"/>
                        </VBox>
                    </HBox>
                </VBox>

                <!-- Game Info (Center) -->
                <VBox alignment="CENTER" spacing="5" GridPane.columnIndex="1">
                    <Label fx:id="roomIdLabel" text="ROOM ID: 0000" styleClass="game-info-label"/>
                    <Label fx:id="timeLabel" text="Time: 60s" styleClass="game-info-label"/>
                    <Label fx:id="orderLabel" text="Order: ASC" styleClass="game-info-label"/>
                </VBox>

                <!-- Player 2 Panel (OPPONENT) -->
                <VBox styleClass="player-panel" alignment="CENTER_RIGHT" GridPane.columnIndex="2">
                    <HBox alignment="CENTER_RIGHT" spacing="15">
                        <VBox alignment="CENTER_RIGHT">
                            <Label fx:id="opponentNickname" text="Opponent" styleClass="player-nickname"/>
                            <Label fx:id="opponentWins" text="Wins: 0" styleClass="player-sub-stats"/>
                        </VBox>
                        <ImageView fx:id="opponentAvatar" fitHeight="50" fitWidth="50" styleClass="avatar-image"/>
                    </HBox>
                </VBox>
            </GridPane>
        </top>

        <!-- CENTER: Game Zone -->
        <center>
            <VBox fx:id="gameZone" styleClass="game-zone" alignment="CENTER" spacing="15">
                <BorderPane.margin>
                    <Insets top="20" bottom="20"/>
                </BorderPane.margin>
                <VBox fx:id="topRowContainer" alignment="CENTER"/>
                <Line fx:id="dividerLine" startX="-400" endX="400" styleClass="divider-line"/>
                <VBox fx:id="bottomRowContainer" alignment="CENTER"/>
            </VBox>
        </center>

        <!-- BOTTOM: Score & Buttons -->
        <bottom>
            <HBox alignment="CENTER" spacing="50">
                <!-- Score Display -->
                <HBox styleClass="current-score-panel" alignment="CENTER" spacing="20">
                    <VBox alignment="CENTER">
                        <Label fx:id="userCurrentScore" text="0" styleClass="current-score-value"/>
                        <Label fx:id="userScoreChange" styleClass="score-change"/>
                    </VBox>
                    <Label text="-" styleClass="current-score-separator"/>
                    <VBox alignment="CENTER">
                        <Label fx:id="opponentCurrentScore" text="0" styleClass="current-score-value"/>
                        <Label fx:id="opponentScoreChange" styleClass="score-change"/>
                    </VBox>
                </HBox>

                <!-- Action Buttons -->
                <HBox alignment="CENTER" spacing="20">
                    <Button fx:id="resetButton" text="RESET" onAction="#onReset" styleClass="game-button, reset-button"/>
                    <Button fx:id="sendButton" text="SEND" onAction="#onSendAnswer" styleClass="game-button, send-button"/>
                    <Button fx:id="continueButton" text="CONTINUE" onAction="#onContinue" styleClass="game-button, continue-button" visible="false"/>
                </HBox>
            </HBox>
        </bottom>

        <!-- Exit Button -->
        <StackPane BorderPane.alignment="TOP_RIGHT">
            <Button fx:id="exitButton" text="✕" onAction="#onExit" styleClass="exit-button"/>
        </StackPane>
        
        <!-- Các Label ẩn để Controller không báo lỗi -->
        <VBox visible="false">
            <Label fx:id="userTotalMatches"/>
            <Label fx:id="userScore"/>
            <Label fx:id="opponentTotalMatches"/>
            <Label fx:id="opponentScore"/>
        </VBox>
    </BorderPane>
</StackPane>